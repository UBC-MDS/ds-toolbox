---
format: revealjs
title: Publish your book online
title-slide-attributes:
  data-notes: |
    In this section, we will learn how we can host our Jupyter Books online for free using GitHub Pages.
---

```{python}
#  | echo: false
%run src/utils.py
```


## GitHub Pages

![](../../../static/module8/gh-pages.png){width="90%" fig-alt="404 image"}

[https://pages.github.com/](https://pages.github.com/)


:::{.notes}
Once you’ve built the HTML for your book, you can host it online.

- The most convenient way to do this is with a service that supports **static websites**. This means that the files we created with Jupyter Book's `build` command can simply be uploaded to a web server to create a web page.

- The quickest and most convenient option for publishing your book website online is to use **GitHub Pages**.

There are a few steps to follow to publish your book using GitHub Pages. We'll go over those steps in the following slides.
:::

---

## Create an online repository for your book

![](../../../static/module8/ghp-mynewbook.png){width="60%" fig-alt="404 image"}


:::{.notes}
1. First, login on GitHub, then go to the “create a new repository” page, which is linked here: [https://github.com/new](https://github.com/new)

2. Next, give your online repository a name and a description. Make your repository **public** and **do not** initialize it with a README file. Your screen should look like this:

3. Click “Create repository” at the end of the page.

After this step,
we can go ahead and upload the built Jupyter Book to our GitHub repo directly.

However, it's a good idea to first push the **source files** of our Jupyter Book to GitHub.
:::

---

## Push the source files to GitHub

1. Clone the empty online repository to your computer:

    ```sh
    git clone https://github.com/<my-org>/<my-repository-name>
    ```

<br>

2. Copy your book files into this newly cloned repository:

    ```sh
    cp -r mynewbook/* myonlinebook/
    ```

<br>

3. Add `_build/` to your `.gitignore` to avoid pushing **build artifacts** to your `main` branch

<br>

4. Sync your local and remote repositories:

    ```sh
    cd myonlinebook
    git add ./*
    git commit -m "adding my first book!"
    git push
    ```


:::{.notes}
Let's now learn how to push the source files to our books online repository:

1. First, clone the (currently empty) online repository to a location on your local computer. You can do this using the `git clone` command:

    ```sh
    git clone https://github.com/<my-org>/<my-repository-name>
    ```

2. Copy all of your book's files and folders into this newly cloned repository. For example, if you created your book locally using the `jupyter-book create mynewbook` command, and your new repository is called `myonlinebook`, you can do this in the command line using `cp -r` as shown on the slide:

    ```sh
    cp -r mynewbook/* myonlinebook/
    ```

3. Add `_build/` to your `.gitignore` to avoid pushing **build artifacts** to your `main` branch. We are going to push these files and folders to another branch later to create the website.

4. Now you need to sync your local and remote (i.e., online) repositories. You can do this with the last series of commands shown on the slide:

    ```sh
    cd myonlinebook
    git add ./*
    git commit -m "Add my first book"
    git push
    ```
:::

---

## Publish your built book online with GitHub Pages

- Next, we have to host the **build artifact** of our book online, although we don't want them on the `main` branch
  - The build artifacts are needed for rendering the book as a website

<br>

- The easiest way is to use the `ghp-import` package
  - `ghp-import` is a lightweight Python package that makes it easy to push HTML content to a GitHub repository

<br>

We'll learn how to use `ghp-import` in the next few slides.


:::{.notes}
We have just pushed the **source files** for our book into our GitHub repository
This makes the source code—that is, the notebooks, markdown document, etc.—publicly accessible for everyone.

However, we still aren't hosting the book's webpage which Jupyter Book has generated for us.

In order to do this, we first need to upload the HTML files generated by the `build` command to GitHub.
These files are usually called **build artifacts**.

The build artifacts are needed for rendering the book as a website,
but we don't want to keep track of numerous build files on the `main` branch using Git.
The build artifacts are temporary and replaceable. You can regenerate the build artifacts solely using your source files by running the `build` command.

Considering what we just discussed, we're going to put the build artifacts on a branch that is specific to GitHub pages,
which is called `gh-pages` by default.

We could upload the build artifacts manually to this site,
but there is a package called `ghp-import` that will automate this process.
`ghp-import` is a lightweight Python package that makes it easy to push HTML content to a GitHub repository.

`ghp-import` works by copying the entire content of your built book (i.e., the `_build/html` folder) to a branch of your repository called `gh-pages` (instead of `main`), and pushing everything to GitHub. This way you don't create unnecessary clutter on your `main` branch.

We'll learn how to use `ghp-import` in the next few slides.
:::

---

## How to use `ghp-import` to publish our book

1. Install `ghp-import`:

    ```sh
    pip install ghp-import
    ```

<br>

2. From the `main` branch of your book’s **local** root directory, call `ghp-import` and point it to your HTML files:

    ```sh
    ghp-import -n -p -f _build/html
    ```

<br>

3. Now `gh-pages` branch is automatically set to host your website HTML files. You can view this in the **settings** page of your GitHub repository:

![](../../../static/module8/ghp-settings.png){width="90%" fig-alt="404 image"}


:::{.notes}
1. First step is to install `ghp-import` using the command

    ```sh
    pip install ghp-import
    ```

in your current conda environment.

<br>

2. Then, from the `main` branch of your book’s **local** root directory (which contains the `_build/html` folder), call `ghp-import` and point it to your HTML files. You can do this by running the second command on the slide:

    ```sh
    ghp-import -n -p -f _build/html
    ```

    With `ghp-import`, we will always use these three flags (namely, `-n`, `-p`, and `-f`). It's not very important to know what each flag does, but here is a brief explanation:

    - The `-n` flag instructs GitHub to not treat this as a "Jekyll" repository (which is another type of static webpage).
    - The `-p` flag is what pushes our changes to GitHub.
    - The `-f` flag create a force push. Since these build artifacts are re-generated each time, we just want to overwrite whatever is in the current `gh-pages` branch with our latest version of these files.
        - This is also mentioned in this warning from the `ghp-import` [GitHub repository](https://github.com/c-w/ghp-import) which tells you that:
            > <b><p style="margin-left:5%; color:darkred;">
            "...`ghp-import` will DESTROY your `gh-pages` branch... and assumes that the `gh-pages` branch is 100% derivative. You should never edit files in your `gh-pages` branch by hand if you’re using this script..."
</p></b>

<br>

3. Now the `gh-pages` branch is automatically set to host your website HTML files. You can view this in the **settings** page of your GitHub repository as shown in this slide.
:::

---

## Your book is now online!

- Typically, your website should be viewable online after a few minutes at a URL such as: `https://<user>.github.io/<myonlinebook>/`

<br>

<img style="border:1px solid black;" src="../../../static/module8/ghp-online.png" width="90%"></img>


:::{.notes}
- Typically, your website should be viewable online after a few minutes at a URL such as: `https://<user>.github.io/<myonlinebook>/`

<br>

- If not, check your repository settings (under **Settings -> Pages**).
:::

---

## How to update your book

- Make changes to your book’s content on the `main` branch of your repository

<br>

- Re-build your book with `jupyter-book build myonlinebook/`

<br>

- Use `ghp-import -n -p -f myonlinebook/_build/html` to push the changes to the `gh-pages` branch.


:::{.notes}
In order to update the content of your book:

- Make your desired changes to the source files on the `main` branch of your repository

<br>

- Next, re-build your book with `jupyter-book build myonlinebook/`

<br>

- And finally, use `ghp-import -n -p -f myonlinebook/_build/html` to push the changes to the `gh-pages` branch.
:::


# Let's apply what we learned!